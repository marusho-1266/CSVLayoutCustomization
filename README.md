# CSVレイアウト変更ツール

CSVファイルのレイアウトを簡単に変更できるWindows用デスクトップアプリケーションです。項目の並べ替え、結合、文字の除去・追加などの操作を直感的に行うことができます。

## 主な機能

- **項目の並べ替え**: CSVファイルの列順序を自由に変更
- **複数項目の結合**: 複数の列を結合して新しい列を作成
- **項目内の特定文字の除去**: 列内の特定の文字を削除
- **項目への特定文字の追加**: 列の値の前後に文字を追加
- **住所項目からの都道府県除去**: 指定した住所項目から都道府県名（例: 東京都、北海道）を削除
- **ドラッグ&ドロップ対応**: ファイルを直接ツール上にドロップして処理
- **プロファイル機能**: 設定を保存・再利用可能
- **文字コード対応**: UTF-8とShift-JIS(SJIS)の両方に対応
- **都道府県コードの取得**: 都道府県名が含まれる項目から、対応する都道府県コード（JIS X 0401）を取得して新しい列を追加
- **文字列の抽出**: 特定の項目から指定した位置と文字数で文字列を抜き出し、新しい列を作成
- **ヘッダー行の除去**: 出力CSVファイルからヘッダー行（1行目）を除去
- **文字の置換**: 特定の列の文字列を別の文字列に置換

## インストール方法

### 実行ファイルから（一般ユーザー向け）

1. 提供されたZIPファイルをダウンロードして解凍
2. `CSVLayoutCustomization.exe` をダブルクリックして実行

### ソースコードから（開発者向け）

1. リポジトリをクローンまたはダウンロード
2. 必要なライブラリをインストール
   ```
   pip install pandas tkinterdnd2
   ```
3. Pythonスクリプトを実行
   ```
   python CSVLayoutCustomization.py
   ```

## 使い方

### 基本的な操作手順

1. ツールを起動
2. 左側のパネルでプロファイルを選択または新規作成
3. 必要な設定を入力（並べ替え、結合、文字除去、文字追加）
4. 右側のパネルで入力/出力の文字コードを選択
5. CSVファイルをドラッグ&ドロップするか「ファイルを選択」ボタンでファイルを読み込み
6. プレビューで結果を確認
7. 「変換して保存」ボタンをクリックして変換結果を保存

### 設定方法

#### 項目の並べ替え

カンマ区切りで項目名を入力すると、指定した順に並べ替えられます。
リストに記載されていない項目は出力結果に含まれません。
```
氏名,住所,電話番号,メールアドレス
```

また、カンマを連続して使用する (`,,`) ことで、その位置に空の列（ヘッダーも値も空）を挿入できます。
```
項目A,,項目B,項目C
```
※ 上記例では、「項目A」と「項目B」の間に空の列が挿入されます。

#### 複数項目の結合

以下の形式で入力すると、複数の項目を結合できます。
```
`新項目名:結合元項目1,結合元項目2...,区切り文字`
```
**入力例:**
氏名:姓,名, 住所:都道府県,市区町村,番地,- フルパス:ドライブ,フォルダ,ファイル名,\

※ **最後のカンマ (`,`) 以降の文字列全体が区切り文字**として扱われます。
※ 上記例では、「氏名」は区切り文字なし、「住所」はハイフン (`-`) 区切り、「フルパス」はバックスラッシュ (`\`) 区切りになります。
※ 区切り文字が不要な場合は、最後にカンマのみを記述します。

#### 項目内の特定文字の除去

以下の形式で入力すると、特定の文字を除去できます。
```
電話番号:-,(,)
商品コード:※
```

### 文字列の抽出

「文字列抽出」タブで、特定の項目から一部分の文字列を抜き出して新しい項目を作成できます。

以下の形式で入力します（1行に1つの抽出ルール）。

新項目名:抽出元項目:開始位置:文字数

- **新項目名**: 抽出結果を格納する新しい列の名前
- **抽出元項目**: 文字列を抽出する元の列の名前
- **開始位置**: 抽出を開始する文字の位置（先頭は1）
- **文字数**: 抽出する文字の数

**入力例:**
商品コード前半:商品コード:1:5
郵便番号下4桁:郵便番号:5:4

※ 上記例では、「商品コード」列の1文字目から5文字を「商品コード前半」列に、「郵便番号」列の5文字目から4文字を「郵便番号下4桁」列に抽出します。
※ 開始位置や文字数が元の文字列の範囲を超える場合、抽出結果は空文字になります。

#### 項目への特定文字の追加

以下の形式で入力すると、特定の位置に文字を追加できます。
```
商品コード:前:A-
価格:後:円
```
※ 位置は「前」または「後」を指定します。

### 住所項目からの都道府県除去

「文字除去」タブ内にある以下の設定で、指定した項目から都道府県名を削除できます。

1.  **「住所項目から都道府県を削除する」チェックボックス**: この機能を有効にする場合にチェックします。
2.  **「対象項目名 (複数可, カンマ区切り):」入力欄**: 都道府県を削除したい項目名を指定します。複数の項目を指定する場合は、カンマ区切りで入力します。（例: `住所1,所在地`）

※ 削除対象となるのは、日本の47都道府県名（例: 東京都、大阪府、北海道）が項目の先頭にある場合です。

### 文字の置換

「文字置換」タブで、特定の項目に含まれる文字列を別の文字列に置き換えることができます。

以下の形式で入力します（1行に1つの置換ルール）。

`項目名:置換前文字列:置換後文字列`

- **項目名**: 置換対象の列の名前
- **置換前文字列**: 置き換えたい元の文字列
- **置換後文字列**: 置き換え後の新しい文字列（空文字列も指定可能）

**入力例:**
ステータス:処理中:完了
商品名:旧製品:新製品
備考:（削除）:

※ 上記例では、「ステータス」列の「処理中」という文字列を「完了」に、「商品名」列の「旧製品」を「新製品」に、「備考」列の「（削除）」を空文字列（つまり削除）に置換します。
※ この機能は、**置換前文字列と完全に一致する値**のみを置換します。部分一致ではありません。
※ 置換前文字列が空の場合は、意図しない置換を防ぐため処理はスキップされます。


### 都道府県コードの取得

「都道府県コード」タブ内の設定で、指定した項目から都道府県名を基にコードを取得し、新しい列として追加できます。

1.  **「都道府県名からコードを取得して新しい列を追加する」チェックボックス**: この機能を有効にする場合にチェックします。
2.  **「都道府県名を含む項目名:」入力欄**: 都道府県名が含まれている既存の項目名を指定します。（例: `住所`, `所在地`）
3.  **「新しい項目名 (コード列):」入力欄**: 生成される都道府県コードを格納する新しい列の名前を指定します。デフォルトは `都道府県コード` です。

※ 処理は、指定された項目の値の先頭が日本の47都道府県名（例: 東京都、大阪府、北海道）と一致する場合に行われ、対応する2桁の都道府県コードが新しい列に追加されます。一致しない場合は、新しい列には空文字が入ります。

### ヘッダー行の除去

右側の「プレビューと実行」エリアにある **「出力時にヘッダー行を除去する」** チェックボックスをオンにすると、変換後のCSVファイルからヘッダー行（項目名が記載された1行目）が除去されます。

### プロファイル管理

- **新規**: 新しいプロファイルを作成
- **保存**: 現在の設定をプロファイルに保存
- **削除**: 選択中のプロファイルを削除

## 文字コード対応

- **入力文字コード**: CSVファイルを読み込む際のエンコーディング（UTF-8またはShift-JIS）
- **出力文字コード**: 変換後のCSVファイルを保存する際のエンコーディング（UTF-8またはShift-JIS）

選択したエンコーディングでファイルを読み込めない場合、自動的に代替エンコーディングが試行されます。

## 複数端末での利用

このツールは以下の方法で複数の端末で共有できます：

1. 実行ファイル（EXE）を各端末にコピー
2. プロファイル設定ファイル（csv_profiles.json）を各端末の実行ファイルと同じディレクトリにコピー

これにより、設定を共有しながら複数の端末で同じ操作が可能になります。

## 動作環境

- Windows 11
- 推奨メモリ: 4GB以上
- ディスク容量: 50MB以上の空き容量

## トラブルシューティング

### ファイルが読み込めない場合

- ファイルが有効なCSV形式か確認
- 別の文字コードを選択して試す
- ファイルが他のプログラムで開かれていないか確認

### 変換結果が期待通りでない場合

- プレビューで結果を確認
- 項目名が正確に入力されているか確認
- 書式が正しいか確認（カンマ、コロンの使い方など）

### プログラムが起動しない場合

- Windowsのセキュリティソフトがブロックしていないか確認
- .NET Frameworkがインストールされているか確認

## 更新履歴

### v1.0.0 - 2025/04/10
- 初回リリース
- 基本機能の実装（項目の並べ替え、結合、文字除去・追加）
- プロファイル機能の実装
- UTF-8/Shift-JIS対応機能の追加

### v1.0.1 - 2025/04/10
- 入力文字コード・出力文字コードの初期表示変更

### v1.0.2 - 2025/04/11
- プレビュー画面に横スクロールバーを追加
- 空白項目の「nan」が設定される現象を修正
- 項目間のスペース削除機能追加
- 住所項目から都道府県名を削除する機能を追加

### v1.0.3 - 2025/04/14
- 都道府県コード取得機能を追加

### v1.0.4 - 2025/04/14
- 文字列抽出機能を追加

### v1.0.5 - 2025/04/15
- 出力時にヘッダー行を除去するオプションを追加
  
### v1.0.6 - 2025/04/16
- 文字置換機能を追加
- CSV読み込み時に数値が意図せず浮動小数点数として扱われ、文字置換が正しく機能しない問題を修正（内部的にすべての列を文字列として読み込むように変更）